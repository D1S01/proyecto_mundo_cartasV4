{% extends 'tienda/base.html' %}

{% block content %}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-black fw-bold mb-0">Ventas del día {{ fecha }}</h2>
        <div class="total_dia d-flex flex-column align-items-end">
            <h5 class="mb-2">Total Ventas del Día: <span class="text-success fw-bold">
                    ${{ total_ventas_dia }}</span>
            </h5>
            <a href="{% url 'reporte_dias' año mes %}" class="btn btn-primary btn-sm">Volver</a>
        </div>
    </div>

    <hr class="border-dark opacity-50">

    {% if ventas %}
    {% for venta in ventas %}

    <div class="d-flex justify-content-between mt-2 mb-2">
        {% comment %} venta empezando desde uno {% endcomment %}
        <div class="d-flex align-items-center gap-2">
            <h3 class="text-primary fw-bold mb-0">Venta #{{ forloop.revcounter }}</h3>
            <a href="{% url 'boleta' venta.id %}" target="_blank" class="btn btn-sm btn-secondary border-0"
                title="Imprimir Boleta">
                <i class="bi bi-printer-fill"></i>
            </a>
        </div>
        {% comment %} <h3 class="text-primary fw-bold mb-0">Venta #{{ venta.id }}</h3> {% endcomment %}
        <p class="d-flex mb-0 fs-5 text-black" style="flex-direction: row; gap: 3px; align-items: end;">
            <strong>Total Venta:</strong>
            <span class="text-success fw-bold">
                {% if venta.descuento > 0 %}
                ${{ venta.total_con_descuento|floatformat:2 }}
                {% else %}
                ${{ venta.total|floatformat:2 }}
                {% endif %}
            </span>
        </p>
    </div>

    {% comment %} <p class="text-black mb-1">
        <strong>Vendedor:</strong> {{ venta.usuario.usuarios.nombre_completo }}
    </p>
    <p class="text-black mb-3">
        <strong>Fecha y Hora:</strong> {{ venta.fecha_venta }}
    </p> {% endcomment %}

    <div class="table-responsive mb-2">
        <table class="table table-bordered border-secondary mb-0">
            <thead class="table-dark">
                <tr>
                    <th>Vendedor</th>
                    <th>Fecha y Hora</th>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Costo Unitario</th>
                    <th>Costo Total</th>
                </tr>
            </thead>
            <tbody class="bg-white">
                {% for d in venta.detalle_venta_set.all %}
                <tr>
                    <td class="text-black">{{ venta.usuario.usuarios.nombre_completo }}</td>
                    <td class="text-black">{{ venta.fecha_venta|date:"d/m/Y H:i" }}</td>
                    <td class="text-black">{{ d.producto.nombre }}</td>
                    <td class="text-center">{{ d.cantidad }}</td>
                    <td class="text-end">${{ d.precio_unitario }}</td>
                    <td class="text-end fw-bold">${{ d.subtotal }}</td>
                </tr>
                {% endfor %}
                {% if venta.descuento > 0 %}
                <tr>
                    <td colspan="4" class="border-0"></td>
                    <td class="text-end border-start"><strong>Subtotal:</strong></td>
                    <td class="text-end fw-bold text-dark border-start">${{ venta.total|floatformat:2 }}</td>
                </tr>
                <tr>
                    <td colspan="4" class="border-0"></td>
                    <td class="text-end text-success border-start"><strong>Descuento ({{ venta.descuento }}%):</strong>
                    </td>
                    <td class="text-end text-success fw-bold border-start">-${{ venta.descuento_monto|floatformat:2 }}
                    </td>
                </tr>
                <tr class="table-secondary">
                    <td colspan="4" class="border-0 bg-white"></td>
                    <td class="text-end border-start"><strong>Total Final:</strong></td>
                    <td class="text-end fw-bold border-start">${{ venta.total_con_descuento|floatformat:2 }}</td>
                </tr>
                {% else %}
                <tr class="table-secondary">
                    <td colspan="4" class="border-0 bg-white"></td>
                    <td class="text-end border-start"><strong>Total:</strong></td>
                    <td class="text-end fw-bold border-start">${{ venta.total|floatformat:2 }}</td>
                </tr>
                {% endif %}
                <tr>
                    <td colspan="4" class="border-0"></td>
                    <td class="text-end border-start">Método de Pago:</td>
                    <td class="text-end border-start">{{ venta.get_metodo_pago_display }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <hr class="border-dark opacity-25">

    {% endfor %}
    {% else %}
    <div class="alert alert-secondary text-center mt-4">
        No hay ventas registradas este día.
    </div>
    {% endif %}

</div>

{% endblock %}